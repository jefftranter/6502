ca65 V2.19 - Git dbcfa9108
Main file   : program5.s
Current file: program5.s

000000r 1               ; Program Module #5
000000r 1               
000000r 1               .INCLUDE        "pagezero.s"
000000r 2               ; Page zero addresses
000000r 2               
000000r 2               DCDLO   =       $00             ; Application Address Low
000000r 2               DCDHI   =       $03             ; Application Address High
000000r 2               
000000r 2               PARAM0  =       $B0             ; Parameter 0 is usually the COMMAND CODE
000000r 2               PARAM1  =       $B1             ; Parameter 1 is usually DATA
000000r 2               PARAM2  =       $B2             ; Parameter 2 is usually DATA
000000r 2               PARAM3  =       $B3             ; Parameter 3 is usually DATA
000000r 2               ADRLO   =       $B4             ; Low Address pointer for Indirect Address
000000r 2               ADRHI   =       $B5             ; High Address pointer for Indirect Address
000000r 2               PNTR    =       $B6             ; Temporary Pointer Storage
000000r 2               STEPNO  =       $B7             ; Number of NEXT PLEASE Step
000000r 2               STEPLO  =       $B8             ; Low Address of Current PLEASE Step
000000r 2               STEPHI  =       $B9             ; High Address of Current PLEASE Step
000000r 2               TRANLO  =       $BA             ; Temporary Transfer Pointer to PLEASE Function
000000r 2               TRANHI  =       $BB             ; Temporary Transfer Pointer to PLEASE Function
000000r 2               PLACE   =       $BB             ; Alternate name
000000r 2               FUNTBL  =       $BC             ; Low Address of PLEASE Function Table
000000r 2               FUNTBH  =       $BD             ; High Address of PLEASE Function Table
000000r 2               PTEMP0  =       $BE             ; PLEASE Temporary Storage
000000r 2               PTEMP1  =       $BF             ; PLEASE Temporary Storage
000000r 2               TEMP1   =       PTEMP0
000000r 2               TEMP2   =       PTEMP1
000000r 2               
000000r 2               THOUS   =       $C0             ; Thousands and Tens of Thousands of Seconds
000000r 2               TENS    =       $C1             ; Tens and Hundreds of Seconds
000000r 2               TENTHS  =       $C2             ; Tenths and Seconds
000000r 2               MILLI   =       $C3             ; Thousandths and hundredths of Seconds
000000r 2               HOUR    =       $C4             ; Hour portion of 24 Hour Clock
000000r 2               MINUTE  =       $C5             ; Minute portion of 24 Hour Clock
000000r 2               SECOND  =       $C6             ; Second portion of 24 Hour Clock
000000r 2               ONESEC  =       $C7             ; Counter for One Second
000000r 2               
000000r 2               DSP0    =       $C8             ; Display position 0 (Leftmost Digit)
000000r 2               DSP1    =       $C9             ; Display position 1
000000r 2               DSP2    =       $CA             ; Display position 2
000000r 2               DSP3    =       $CB             ; Display position 3
000000r 2               DSP4    =       $CC             ; Display position 4
000000r 2               DSP5    =       $CD             ; Display position 5 (Rightmost Digit)
000000r 2               DSPLO   =       $CE             ; Low Address of Display Buffer (Usually = DSP0 = C8)
000000r 2               DSPHI   =       $CF             ; High Address of Display Buffer (Usually = DSP0 = 00)
000000r 2               
000000r 2               DCONLO  =       $D0             ; Display Conversion Table Low Address
000000r 2               DCONHI  =       $D1             ; Display Conversion Table High Address
000000r 2               DTABLO  =       DCONLO
000000r 2               DTABHI  =       DCONHI
000000r 2               HEXDEC  =       HEXLO
000000r 2               HEXLO   =       $D2             ; Hexadecimal (and Decimal) Conversion Table Low Address = E7
000000r 2               HEXHI   =       $D3             ; Hexadecimal (and Decimal) Conversion Table High Address = 1F
000000r 2               ALPHLO  =       $D4             ; Alphabetic Conversion Table Low Address (usually = F0)
000000r 2               ALPHHI  =       $D5             ; Alphabetic Conversion Table High Address (usually = 03)
000000r 2               XTABLE  =       $D6             ; Used by Conversion Routine to Point to HEX or ALPHA Table
000000r 2               TEMP    =       $D7             ; General Purpose Temporary Save Location
000000r 2               LIMIT   =       $D8             ; Uses by Conversion Routine.  General Purpose Register
000000r 2               DSPPOS  =       $D9             ; Executive Pointer to Current Display Position
000000r 2               CURPNT  =       $DA             ; Used by Input Routines as Current Data Pointer.
000000r 2               CHAR    =       $DB             ; Save location for Input Character
000000r 2               CTABLO  =       $DC             ; Command Table Low Address (usually = A0)
000000r 2               CTABHI  =       $DD             ; Command Table High Address (usually = 00)
000000r 2               KEYTST  =       $DE             ; Used by Executive as part of Keyboard Input
000000r 2               KEYVAL  =       $DF             ; Contains Last Character if Input String
000000r 2               
000000r 2               BUF0    =       $E0             ; General Purpose Buffer
000000r 2               BUF1    =       $E1
000000r 2               BUF2    =       $E2
000000r 2               BUF3    =       $E3
000000r 2               BUF4    =       $E4
000000r 2               BUF5    =       $E5
000000r 2               
000000r 2               ALT0    =       $E6             ; Alternate General Purpose Buffer
000000r 2               ALT1    =       $E7
000000r 2               ALT2    =       $E8
000000r 2               ALT3    =       $E9
000000r 2               ALT4    =       $EA
000000r 2               ALT5    =       $EB
000000r 2               
000000r 2               APL0    =       $EC             ; Application General Registers
000000r 2               APL1    =       $ED
000000r 2               APL2    =       $EE
000000r 2               
000000r 1               
000000r 1               ; Please Functions
000000r 1               
000000r 1               NXTSTP  =      $0304
000000r 1               
000000r 1               ; Please command codes
000000r 1               
000000r 1               ALPIN   =       $00
000000r 1               ASTABH  =       $00
000000r 1               BLNK    =       $00
000000r 1               DECODE  =       $00
000000r 1               TTABHI  =       $00
000000r 1               DECIN   =       $02
000000r 1               DECOUT  =       $04
000000r 1               ADDSUB  =       $04
000000r 1               NEW     =       $05
000000r 1               TIMER   =       $05
000000r 1               PACK    =       $06
000000r 1               NEXT    =       $06
000000r 1               UNPACK  =       $07
000000r 1               BRANCH  =       $08
000000r 1               ADD     =       $09
000000r 1               BRCHAR  =       $09
000000r 1               BRTABL  =       $0A
000000r 1               FILL    =       $0B
000000r 1               SHOW    =       $0B
000000r 1               WAIT    =       $0D
000000r 1               SUB     =       $0F
000000r 1               DECADD  =       $10
000000r 1               DECSUB  =       $11
000000r 1               FLASH   =       $12
000000r 1               GO      =       $13
000000r 1               BLANK   =       $13
000000r 1               WAIT2   =       $15
000000r 1               REACT   =       $1A
000000r 1               START   =       $1C
000000r 1               TEST    =       $1D
000000r 1               WAIT3   =       $21
000000r 1               STOP    =       $23
000000r 1               ASTAB   =       $5E
000000r 1               ASTABL  =       $60
000000r 1               TTABLO  =       $90
000000r 1               TTABLE  =       $9E
000000r 1               DISPLAY =       $C8
000000r 1               DSPLAY  =       $C8
000000r 1               CMDTBL  =       $DC
000000r 1               BUFFER  =       $E0
000000r 1               HALT    =       $1E
000000r 1               AREG    =       $E6
000000r 1               BREG    =       $E9
000000r 1               
000000r 1                       .ORG    $0000
000000  1               
000000  1               ;               COMMAND  PARAM1     PARAM2    PARAM3   STEP LABEL
000000  1               
000000  1               ; Command Decoder
000000  1  00 E0 00 05          .BYTE   ALPIN,   BUFFER,    0,        5      ;  0   DECODE
000004  1  06 E0 DF 01          .BYTE   PACK,    BUFFER,    KEYVAL,   1      ;  1
000008  1  0B C8 00 06          .BYTE   FILL,    DISPLAY,   0,        6      ;  2
00000C  1  0A DC DF 00          .BYTE   BRTABL,  CMDTBL,    KEYVAL,   DECODE ;  3
000010  1               
000010  1               ; Add and Subtract
000010  1  02 E0 05 00          .BYTE   DECIN,   BUFFER,    5,        0      ;  4   ADDSUB
000014  1  06 E0 E6 03          .BYTE   PACK,    BUFFER,    AREG,     3      ;  5   NEW
000018  1  02 E0 05 00          .BYTE   DECIN,   BUFFER,    5,        0      ;  6   NEXT
00001C  1  06 E0 E9 03          .BYTE   PACK,    BUFFER,    BREG,     3      ;  7
000020  1  0A 5E DF 05          .BYTE   BRTABL,  ASTAB,     KEYVAL,   NEW    ;  8
000024  1  10 E6 E9 E6          .BYTE   DECADD,  AREG,      BREG,     AREG   ;  9   ADD
000028  1  08 12 00 00          .BYTE   BRANCH,  FLASH,     0,        0      ;  A
00002C  1  07 E6 E0 06          .BYTE   UNPACK,  AREG,      BUFFER,   6      ;  B   SHOW
000030  1  04 E0 00 05          .BYTE   DECOUT,  BUFFER,    0,        5      ;  C
000034  1  09 13 00 06          .BYTE   BRCHAR,  GO,        DECODE,   NEXT   ;  D   WAIT
000038  1  08 0D 00 00          .BYTE   BRANCH,  WAIT,      0,        0      ;  E
00003C  1  11 E6 E9 E6          .BYTE   DECSUB,  AREG,      BREG,     AREG   ;  F   SUB
000040  1  08 12 00 00          .BYTE   BRANCH,  FLASH,     0,        0      ; 10
000044  1  08 0B 00 00          .BYTE   BRANCH,  SHOW,      0,        0      ; 11
000048  1  05 02 13 00          .BYTE   TIMER,   2,         BLANK,    0      ; 12   FLASH
00004C  1  0B C8 00 06          .BYTE   FILL,    DISPLAY,   0,        6      ; 13   BLANK
000050  1  05 02 15 00          .BYTE   TIMER,   2,         WAIT2,    0      ; 14
000054  1  04 E0 00 05          .BYTE   DECOUT,  BUFFER,    0,        5      ; 15   WAIT2
000058  1  09 13 00 04          .BYTE   BRCHAR,  GO,        DECODE,   ADDSUB ; 16
00005C  1  08 12 60 00          .BYTE   BRANCH,  FLASH,     ASTABL,   ASTABH ; 17
000060  1  12 09 11 0F          .BYTE   $12,     ADD,       $11,      SUB    ; 18
000064  1  00 00 00 00          .BYTE   0,       0,         0,        0      ; 19
000068  1               
000068  1               ; Reaction Time Tester
000068  1  09 13 00 1C          .BYTE   BRCHAR,  GO,        DECODE,   START  ; 1A   REACT
00006C  1  08 1A 00 00          .BYTE   BRANCH,  REACT,     00,       00     ; 1B
000070  1  0B C8 3F 06          .BYTE   FILL,    DSPLAY,    $3F,      6      ; 1C   START
000074  1  0A 9E C2 1D          .BYTE   BRTABL,  TTABLE,    TENTHS,   TEST   ; 1D   TEST
000078  1  0B C8 00 06          .BYTE   FILL,    DSPLAY,    BLNK,     6      ; 1E   HALT
00007C  1  07 C1 E0 06          .BYTE   UNPACK,  TENS,      BUFFER,   6      ; 1F
000080  1  06 E0 E6 03          .BYTE   PACK,    BUFFER,    AREG,     3      ; 20
000084  1  09 13 00 23          .BYTE   BRCHAR,  GO,        DECODE,   STOP   ; 21   WAIT
000088  1  08 21 00 00          .BYTE   BRANCH,  WAIT3,     0,        0      ; 22
00008C  1  11 C1 E6 E6          .BYTE   DECSUB,  TENS,      AREG,     AREG   ; 23   STOP
000090  1  01 1E 00 00          .BYTE   $01,     HALT,      0,        0      ; 24
000094  1  07 E6 E0 06          .BYTE   UNPACK,  AREG,      BUFFER,   6      ; 25
000098  1  04 E0 00 05          .BYTE   DECOUT,  BUFFER,    0         ,5     ; 26
00009C  1  08 1A 90 00          .BYTE   BRANCH,  REACT,     TTABLO,   TTABHI ; 27
0000A0  1               
0000A0  1               ; Command Table.
0000A0  1               ; JJT: Table was not shown in the original listing but is described in
0000A0  1               ; the LISTING document page 38.
0000A0  1               
0000A0  1               ; Command Keys Step Description
0000A0  1               ;  "AS"   0D   04   Add/Subtract Calculator
0000A0  1               ;  "RE"   C4   1A   Reaction Time Tester
0000A0  1               ;         00   00   End of table
0000A0  1               
0000A0  1                       .RES    $00A0-*, $0000
0000A0  1               
0000A0  1  0D 04 C4 1A          .BYTE   $0D, $04, $C4, $1A, $00, $00, $00, $00
0000A4  1  00 00 00 00  
0000A8  1  00 00 00 00          .BYTE   $00, $00, $00, $00, $00, $00, $00, $00
0000AC  1  00 00 00 00  
0000B0  1               
0000B0  1               ; Special Function Table
0000B0  1               ; JJT: Table was not shown in original listing.
0000B0  1               
0000B0  1  00 00 00 00          .RES    $0120-*, $00
0000B4  1  00 00 00 00  
0000B8  1  00 00 00 00  
000120  1                                       ; Code Word
000120  1  30 01                .WORD   _DECADD ; 10   DECADD
000122  1  51 01                .WORD   _DECSUB ; 11   DECSUB
000124  1  31 01                .WORD   _HEXADD ; 12   HEXADD
000126  1  52 01                .WORD   _HEXSUB ; 13   HEXSUB
000128  1  00 00                .WORD   $0000   ; 14   Not used
00012A  1  00 00                .WORD   $0000   ; 15   Not used
00012C  1  00 00                .WORD   $0000   ; 16   Not used
00012E  1  00 00                .WORD   $0000   ; 17   Not used
000130  1               
000130  1  F8           _DECADD:SED                     ; Set Decimal Mode
000131  1  18           _HEXADD:CLC                     ; Entry for Hex Add
000132  1  A0 03                LDY     #3              ; Service three bytes
000134  1               
000134  1  A6 B1        _NEXT:  LDX     PARAM1          ; Get A buffer digit
000136  1  B5 02                LDA     2,X
000138  1  A6 B2                LDX     PARAM2          ; Add to B buffer digit
00013A  1  75 02                ADC     2,X
00013C  1  A6 B3                LDX     PARAM3          ; Store in C buffer
00013E  1  95 02                STA     2,X
000140  1  C6 B1                DEC     PARAM1          ; Decrement buffer pointers
000142  1  C6 B2                DEC     PARAM2
000144  1  C6 B3                DEC     PARAM3
000146  1  88                   DEY                     ; Decrement byte counter
000147  1  D0 EB                BNE     _NEXT           ; Continue if not zero
000149  1  D8                   CLD                     ; Clear Decimal Mode
00014A  1               
00014A  1  B0 02                BCS     RETURN          ; Test Carry
00014C  1  E6 B7                INC     STEPNO          ; Skip on Step on Normal
00014E  1  4C 04 03     RETURN: JMP     NXTSTP          ; Next Step on Overflow
000151  1               
000151  1  F8           _DECSUB:SED                     ; Set Decimal Mode
000152  1  38           _HEXSUB:SEC                     ; Entry for Hex Subtract
000153  1  A0 03                LDY     #3              ; Service three bytes
000155  1               
000155  1  A6 B1        NXT:    LDX     PARAM1          ; Get A buffer digit
000157  1  B5 02                LDA     2,X
000159  1  A6 B2                LDX     PARAM2          ; Subtract B buffer digit
00015B  1  F5 02                SBC     2,X
00015D  1  A6 B3                LDX     PARAM3          ; Store in C buffer
00015F  1  95 02                STA     2,X
000161  1  C6 B1                DEC     PARAM1          ; Decrement buffer pointers
000163  1  C6 B2                DEC     PARAM2
000165  1  C6 B3                DEC     PARAM3
000167  1  88                   DEY                     ; Decrement byte counter
000168  1  D0 EB                BNE     NXT             ; Continue of not zero
00016A  1  D8                   CLD                     ; Clear Decimal Mode
00016B  1               
00016B  1  90 02                BCC     RETRN           ; Test Borrow
00016D  1  E6 B7                INC     STEPNO          ; Skip on Step if no borrow
00016F  1  4C 04 03     RETRN:  JMP     NXTSTP          ; Next Step if borrow
00016F  1               
